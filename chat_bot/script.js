// ============================
// 1. OpenAI API 키 설정
// ============================
// 여기에 너의 OpenAI API 키를 넣어줘.
// ============================
// 2. 지훈이 맛집/놀거리 데이터 (storeList + 명예의 전당)
// ============================

const storeList = {
  "경희대, 외대": {
    "식당": [
      {
        name: "고흥소곱창 & 부추생삼겹",
        desc: "정문 주변 삼겹살집이다. 고기가 구워져서 나와 먹기 편하다. 곱창도 맛있지만 부추생삼겹이 미칠 듯이 맛있다."
      },
      {
        name: "밀플랜비 한국외대점",
        desc: "한국식 브리또집이다. 실패 없이 무난히 맛있다."
      },
      {
        name: "밀모",
        desc: "국물 요리가 맛있는 한식집이다. 우거지한우탕이 정말 맛있다."
      },
      {
        name: "왼손 우동짜장탕수육",
        desc: "전국적으로 유명한 중식집이다. 우동 3000원, 짜장 3000원, 탕수육 4000원의 미친 가성비에 평범한 중국집의 맛이 난다."
      },
      {
        name: "다해식당",
        desc: "외대생이라면 모르는 사람이 없는 한식집이다. 8000원인 김치볶음밥에 계란후라이 2개가 올라간다. 김치볶음밥이 정말 맛있다."
      },
      {
        name: "브랫패스트",
        desc: "경희대 주변 핫도그 맛집이다. 미국에서 먹은 핫도그의 맛이 그대로 난다."
      },
      {
        name: "촨커",
        desc: "외대 주변 중식집이다. 항상 웨이팅이 있을 정도로 유명하다. 꿔바로우와 토마토계란볶음, 양꼬치가 정말 맛있다. 웨이팅 한 시간이 아깝지 않을 정도다."
      },
      {
        name: "주수사",
        desc: "외대 주변 초밥은 주수사만 알고 있으면 된다. 어디서든지 먹을 수 있는 초밥이란 음식이지만 달라도 무엇인가 다르다. 특모듬초밥과 모듬초밥 중 하나를 주문하면 된다. 양의 차이는 거의 없고 초밥 구성의 차이다."
      }
    ],
    "카페": [
      {
        name: "벤첸트",
        desc: "경희대 주변 카페이다. 에그타르트가 정말 맛있다."
      }
    ],
    "술집": [
      {
        name: "비스마르크",
        desc: "안주가 특별하진 않지만 하이네켄 생맥주가 정말정말정말 맛있다."
      },
      {
        name: "크치치킨 회기점",
        desc: "맛이 특별하진 않지만 생맥주가 무한리필이다."
      }
    ],
    "놀거리": [
      {
        name: "엔터팟",
        desc: "전국적으로 유명한 방탈출 카페. 플레이타임 3시간의 단일테마 방탈출 카페이다. 매달 1일 예약이 열리는데 3일만 되어도 그 달은 예약이 불가능하다."
      },
      {
        name: "미도리 보드게임카페",
        desc: "외대 정문 주변에 있는 보드게임카페이다. 외대 일본어대학 2학년 재학 중이신 선배님이 운영하는 카페로, 방문하면 일대 과잠을 입으신 미남 사장님께서 반겨주신다. 게임이 다양하고 매장도 넓다."
      }
    ]
  },

  "건대": {
    "식당": [
      {
        name: "제면소의하루 건대점",
        desc: "건대 주변 우동집. 살면서 먹은 우동 중 제일 맛있었다. 하루우동과 히모카와우동을 주문하면 된다. 하루우동은 정석적인 국물 우동이고 히모카와우동은 츠케멘식 납작우동이다. (데이트하기 좋음)"
      },
      {
        name: "소문난숯불막창 건대본점",
        desc: "막창 소금구이가 맛있다. 초벌되어서 나와 간편하다."
      }
    ],
    "카페": [
      {
        name: "멜티도나 메리고라운드",
        desc: "지브리 감성 예쁜 카페이다. 내부 인테리어가 아기자기하게 예쁘게 꾸며져 있다."
      },
      {
        name: "오드커피하우스",
        desc: "귀여운 고양이가 있는 카페이다. 개냥이다."
      },
      {
        name: "카우치포테이토",
        desc: "귀여운 강아지가 있는 카페이다. 귀엽다."
      },
      {
        name: "본초쌍화",
        desc: "쌍화차를 파는 카페이다. 1~2인 족욕 자리가 있다. 네이버 예약 필수."
      }
    ],
    "놀거리": [
      {
        name: "원플레이 건대점",
        desc: "외부, 내부 모두 예쁜 만화카페. 만화뿐만 아니라 LP존, OTT존, 닌텐도존 등 여러 공간이 있다."
      },
      {
        name: "코스믹스 만화카페",
        desc: "우주공간 컨셉 만화카페이다. 분위기가 이색적이다."
      }
    ]
  },

  "성수, 뚝섬": {
    "식당": [
      {
        name: "성수온실",
        desc: "분위기가 좋은 양식집이다. 요즘 핫한 넓은면 파스타, 바질면 파스타가 있다. 감자전이 특히 맛있다."
      },
      {
        name: "오밀 성수",
        desc: "분위기가 좋은 양식집이다. 귀여운 오리 토핑이 올라가 있는 오므라이스가 시그니처이다."
      },
      {
        name: "핌피 성수",
        desc: "분위기가 좋은 양식집이다. 허브 양갈비가 시그니처이며, 정말 맛있다. 가격대는 살짝 있는 편이다."
      },
      {
        name: "용용선생 마라도원",
        desc: "진짜 중국식 마라 맛을 맛볼 수 있는 곳이다. 호불호는 살짝 갈릴 수 있다."
      },
      {
        name: "룡룡버거하우스",
        desc: "차이니즈 버거를 파는 집이다. 평소에 볼 수 없는 이색적인 음식을 맛볼 수 있다."
      },
      {
        name: "207다이닝",
        desc: "파인다이닝 양식집이다. 코스로 나오며 정말 맛있다. 대학생이 갈 수 있는 마지노선의 가격대라고 생각한다."
      }
    ],
    "카페": [
      {
        name: "라프레플루트 성수",
        desc: "데이트하기 좋은 카페이다. 딸기 디저트가 정말 맛있다."
      },
      {
        name: "페로몬 성수",
        desc: "특이한 머랭케이크를 먹을 수 있는 곳이다. 홀케이크 예약도 가능하다."
      },
      {
        name: "아무튼 겨울",
        desc: "겨울 콘셉트의 분위기 좋은 카페이다. 눈과 관련된 메뉴들이 많으며 겨울에 방문하기 좋다."
      },
      {
        name: "마망젤라또 성수점",
        desc: "유명한 젤라또 맛집이다. 위스키 젤라또, 인절미 젤라또 등 신기한 젤라또도 있다. 신기한 걸 시도하기보단 무난한 메뉴가 맛있을 것이다."
      }
    ],
    "놀거리": [
      {
        name: "휩드하우스 성수",
        desc: "피부 진단부터 본인 타입에 맞는 폼클렌저를 직접 만들 수 있는 곳이다. 만드는 과정도 어렵지 않고 직원분들이 친절히 알려주신다."
      },
      {
        name: "시로 성수",
        desc: "직접 조향해볼 수 있는 곳이다. 건물 자체 분위기가 좋아 들르기 좋다."
      },
      {
        name: "성수구름다리",
        desc: "서울 노을 스팟 중 한 곳. 해가 질 때쯤 가면 정말 예쁘고 사진도 예쁘게 나온다."
      }
    ]
  },

  "홍대, 합정": {
    "식당": [
      {
        name: "가미우동",
        desc: "가성비 좋은 우동집이다. 맛이 특별하다기보다는 분위기가 좋고 가격이 싸서 방문하는 곳이다. 기본 우동 한 그릇이 6500원이다."
      },
      {
        name: "연하동 연남본점",
        desc: "홍대 근처 일식집이다. 인스타에서 한 번은 봤을 법한 연어 국수를 파는 곳이다. 대왕연어초밥과 꼬꼬동도 맛있다."
      },
      {
        name: "치히로 홍대점",
        desc: "덮밥 전문집이다. 스테키동, 텐동 등 여러 가지 일식 덮밥들이 있다. 대창덮밥이 제일 맛있었고 기억이 오래 남는다."
      },
      {
        name: "또보겠지떡볶이 해피토스점",
        desc: "즉석떡볶이 전문점이다. 양이 매우 많은 것이 특징이며 사이드인 버터갈릭 감자튀김이 매우 맛있다."
      },
      {
        name: "치쿠린 서울",
        desc: "야키토리집이다. 누구와 방문해도 절대 실패는 없을 것이다. 정말 맛있다. 다만 양이 적기 때문에 사이드인 버섯솥밥을 시켜서 같이 먹는 것이 좋다."
      }
    ],
    "카페": [
      {
        name: "터틀힙 연남",
        desc: "여러 가지 종류의 케이크를 먹을 수 있는 분위기 좋은 카페이다. 특히 크레이프류 케이크가 정말 맛있었다."
      },
      {
        name: "발트",
        desc: "요즘 핫한 두바이 초코 디저트 메뉴들을 먹을 수 있는 카페이다. 크로플도 정말 맛있었다."
      },
      {
        name: "츄로101 홍대본점",
        desc: "홍대 길거리에 있는 츄로스 전문점이다. 여름에 아이스크림 츄로스를 먹으면서 돌아다니기 좋다."
      },
      {
        name: "코코로카라",
        desc: "푸딩이 맛있는 카페이다. 푸딩의 종류가 시즌마다 바뀌어 매번 방문할 때마다 색다른 푸딩을 맛볼 수 있다."
      }
    ],
    "놀거리": [
      {
        name: "야닝",
        desc: "프라이빗한 시간을 보낼 수 있는 대실 전용 공간이다. 음식 배달도 가능하며 빔 프로젝터로 OTT도 시청 가능하다."
      },
      {
        name: "아이아이 연남",
        desc: "서로의 마음을 확인할 수 있는 심리 확인 체험 공간이다. 여러 체험형 전시를 할 수 있으며 결과에 대한 상담도 가능하다."
      },
      {
        name: "씨더라이트",
        desc: "암전된 방에서 상대방과 여러 활동을 할 수 있는 공간이다. 아무것도 보이지 않는 방에서 음료수 맛보고 맞추기, 상대방에게 편지 써주기, 물체를 만져보고 무엇인지 맞춰보기 등 재미있는 활동을 할 수 있다."
      }
    ]
  },

  "혜화": {
    "식당": [
      {
        name: "혜화도담",
        desc: "김치찜 전문점이다. 살면서 먹은 김치찜 중 가장 맛있는 집이다. 공깃밥이 무한리필이다. 고기가 정말 많이 들어가며 부드럽고 맛있다. 또한 파전에는 대파가 들어가 바삭하고 정말 맛있었다."
      },
      {
        name: "해피니스",
        desc: "중식집이다. 돌판 짜장이 시그니처이며 정말 맛있었다. 동파육 또한 합리적인 가격으로 상당한 퀄리티로 제공되었다."
      },
      {
        name: "벅벅 종로혜화점",
        desc: "수제버거 전문점이다. 살면서 먹은 수제버거 중 단연 일등이다. 혈관이 꽉 막히는 다소 폭력적인 맛이 난다. 한 번의 식사로도 진지하게 건강을 걱정하게 만드는 맛이다."
      },
      {
        name: "육미안 혜화점",
        desc: "고깃집이다. 초벌된 안창 갈비가 쫄깃하고 맛있다. 후식으로 치즈 폭탄 볶음밥도 꼭 먹어야 한다."
      },
      {
        name: "고봉당 혜화대학로점",
        desc: "등갈비 전문점이다. 치즈돌판등갈비구이가 정말 맛있고, 사이드로 인절미 떡구이를 꼭 시켜 먹어야 한다. 인절미 떡구이는 유니크하여 다른 곳에서는 볼 수 없는 비주얼이기에 한 번은 꼭 먹어보아야 한다. (특별한 맛까진 아니다)"
      },
      {
        name: "핏제리아오 대학로 본점",
        desc: "수제 화덕 피자를 제대로 하는 집이다. 이탈리아를 가본 적은 없지만, '이것이 정통 이탈리아 피자다'라는 생각이 들게 만드는 맛과 비주얼이다. 근본 피자인 마르게리따를 추천한다."
      },
      {
        name: "스모크 트레인 혜화본점",
        desc: "브리스킷, 풀드포크 등 실제 미국 바베큐 집에서만 먹을 수 있는 메뉴들을 맛볼 수 있다. 미국 현지 바베큐의 맛이 그대로 살아있다."
      }
    ],
    "카페": [
      {
        name: "삼원샏",
        desc: "한옥 콘셉트의 카페이다. 인테리어가 예쁘다. 빙수가 정말 맛있어 여름에 방문을 추천한다."
      },
      {
        name: "칠린",
        desc: "츄로스가 시그니처인 카페이다. 정석으로 튀긴 츄로스의 맛은 인스턴트와 비교가 되지 않는다."
      }
    ],
    "놀거리": [
      {
        name: "그림제작소 혜화점",
        desc: "직접 도화지에 그림을 그릴 수 있는 체험 장소이다. 도안이 많고 직원분께서 친절히 도와주시기 때문에 그림을 잘 그리지 못해도 재밌게 즐길 수 있으며 직원분 덕분에 결과물도 제법 그럴싸하게 나온다."
      },
      {
        name: "낙산공원",
        desc: "서울 야경 스팟 중 가장 대표적인 낙산공원이다. 성벽을 따라 산책로가 잘 되어 있고 노을 시간에 맞춰 올라가면 아름다운 서울 야경을 볼 수 있다."
      }
    ]
  },

  "을지로": {
    "식당": [
      {
        name: "진작",
        desc: "분위기가 좋은 일식집이다. 오니기리와 오차즈케가 정말 맛있었다. 일본 현지에서 먹는 일식의 맛과 분위기를 느낄 수 있다."
      }
    ],
    "놀거리": [
      {
        name: "게임파티룸 힙지롤 을지로점",
        desc: "파티룸이다. PC, 플스, 닌텐도, 노래방 기계 등 여러 콘텐츠들이 준비되어 있어 여럿이서 방문하면 재밌게 즐길 수 있다."
      }
    ],
    "술집": [
      {
        name: "미눔",
        desc: "분위기 좋은 칵테일바이다. 저가형 바가 아니기 때문에 대학생에게 부담되는 가격이지만, 칵테일을 실제로 눈앞에서 만들고 따라주시는 퍼포먼스를 보면 매우 즐겁고 술도 매우 맛있다."
      }
    ]
  },

  "용산": {
    "식당": [
      {
        name: "우동키노야 신용산본점",
        desc: "우동 전문점이다. 시그니처 메뉴인 30cm 장어튀김 붓카케우동을 시켜야 한다. 매우 긴 통 장어튀김이 나오는데 살면서 처음 보는 비주얼일 것이다."
      },
      {
        name: "에비스야 우동 용산점",
        desc: "우동 전문점이다. 일본식 우동 메뉴도 많지만 시그니처 메뉴는 갈비붓카케 우동이다. 일식 우동에서 한국의 맛이 나는 특이한 우동이므로 한번쯤 맛보는 것을 추천한다."
      }
    ],
    "카페": [
      {
        name: "안지",
        desc: "아름다운 인테리어의 카페이다. 유럽 신화에 나올 법한 비주얼의 건물로 매우 예쁘다."
      },
      {
        name: "토터스",
        desc: "해방촌에 있는 수플레 전문점이다. 쫀득말랑한 수플레를 맛볼 수 있다. 분위기가 좋아 수플레 사진이 예쁘게 찍힌다."
      }
    ],
    "놀거리": [
      {
        name: "아이파크몰 용산점",
        desc: "항상 여러 가지 팝업스토어를 진행하며, CGV, 쇼핑몰도 있는 대형 복합 시설이다. 하루 동안 놀아도 다 못 볼 정도의 규모이다."
      },
      {
        name: "용산어린이정원",
        desc: "유치할 것 같지만 아름다운 전시들이 매우 많은 공간이다. 공짜이기 때문에 가난한 대학생들이 들르기 좋다."
      }
    ]
  },

  "압구정": {
    "식당": [
      {
        name: "혜목 논현점",
        desc: "장어덮밥 전문점이다. 장어 덮밥 한 그릇이 4만 원이다. 압구정인 것을 감안하여도 기분이 안 좋을 수 있는데, 일본에서 먹은 장어덮밥보다 맛있었다. 며칠 동안 굶을 각오 하고 먹을 만한 맛이다."
      },
      {
        name: "마일드하이클럽 압구정점",
        desc: "이탈리안 전문점이다. 뇨끼, 라자냐, 파스타 등 여러 양식 메뉴들을 판다. 맛보다는 분위기가 매우 좋으며, 음식의 비주얼이 미쳤다."
      }
    ],
    "카페": [
      {
        name: "런던베이글뮤지엄 도산",
        desc: "유명한 베이글집이다. 잠실에 비하면 웨이팅이 없는 것 같았다. 분위기가 좋다."
      }
    ],
    "놀거리": [
      {
        name: "4233마음센터 압구정점",
        desc: "홍대의 아이아이와 비슷한 심리분석 체험형 전시이다. 연인, 가족 단위로 함께 진행되며 MBTI 질문보다 고차원적인 질문과 활동을 통하여 심리와 생활 패턴을 분석한다. 결과지를 분석해주시기도 하며, 이는 사주보다 정확하다."
      }
    ]
  },

  "종각": {
    "식당": [
      {
        name: "백부장집 닭한마리",
        desc: "닭한마리집 중 국물이 가장 맛있었던 곳이다. 닭도 부드럽고 김치 등 반찬도 맛있지만 국물이 가장 기억에 남으며 맛있다. 어느 정도 먹고 면사리를 반드시 추가하여 먹어야 한다."
      },
      {
        name: "단막 종각점",
        desc: "막창 전문점이다. 직원분이 구워주시기 때문에 먹기 편하다. 대구 막창 스타일로 매우 맛있었다."
      }
    ],
    "카페": [
      {
        name: "마우스포테이토",
        desc: "이색 음료가 많은 카페이다. 히비스커스 피치 트리니티, 페퍼민트 피지 트리니티 등 맛이 상상도 안 되는 음료들을 판매한다. 모든 음료가 개성 있으며 맛있었다."
      }
    ],
    "놀거리": [
      {
        name: "하이커 그라운드",
        desc: "다양한 컨셉의 뮤직비디오 촬영장과 무대장치를 경험해보고, 인터넷 방송 스트리밍 스튜디오 등 한국의 일상 문화를 직접 제공자 입장에서 경험해볼 수 있는 공간이다."
      }
    ]
  },

  "잠실": {
    "식당": [
      {
        name: "Rirr",
        desc: "분위기 좋은 양식집이다. 에그 베네딕트가 시그니처이다. 비주얼, 맛 모두 최고였다."
      }
    ],
    "카페": [
      {
        name: "레브두",
        desc: "겨울에 가면 거대 크리스마스 트리가 전시되어 있는 카페이다. 만겹 크로와상이 시그니처이고, 신기한 촉감과 비주얼의 크루아상을 맛볼 수 있다."
      }
    ],
    "놀거리": [
      {
        name: "롯데타워",
        desc: "아쿠아리움, 백화점 등 콘텐츠가 매우 많은 장소이다. 팝업 스토어도 많이 진행되어 걷기만 해도 보는 재미가 있다."
      }
    ]
  }
};

const hallOfFame = [
  {
    name: "치쿠린 서울",
    desc: "홍대에 위치한 인생 야키토리집. 앞으로 리스트가 업데이트 되어도 치쿠린 이외의 야키토리집은 없을 것이다."
  },
  {
    name: "혜화도담",
    desc: "혜화에 위치한 최고의 김치찜 맛집. 고기가 정말 부드럽고 맛있다."
  },
  {
    name: "제면소의 하루 건대점",
    desc: "어느 지역을 가든 항상 우동집을 가장 먼저 알아볼 정도로 우동 덕후인 필자가 인정하는 우동 맛집이다. 면의 쫄깃함이 이 세상의 것이 아니다."
  },
  {
    name: "주수사",
    desc: "외대 근처에서 가장 맛있는 음식을 판매한다. 외대로 놀러온 친구들, 부모님 모두 식사는 주수사로 대접하였다. 주수사를 다시 먹기 위해 인천에서 외도로 다시 온 친구도 있을 정도로 맛있다."
  },
  {
    name: "고흥소곱창 & 부추삼겹살",
    desc: "삼겹살이 인간 세상 음식의 한계를 뚫은 듯한 맛이다. 흔히 먹던 삼겹살인데 이 식당에서 먹으면 너무 맛있어서 어이가 없다. 규격 외의 고기 맛이 난다."
  }
];

// ============================
// 3. 채팅 UI 관련 함수
// ============================

const chatbox = document.getElementById("chatbox");
const categoryContainer = document.getElementById("category-container");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

function addMessage(sender, text) {
  const div = document.createElement("div");
  div.className = `msg ${sender}`;

  const label = document.createElement("span");
  label.className = "label";
  label.textContent = sender === "user" ? "나" : "서울 맛집 & 놀거리 챗봇";

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.textContent = text;

  div.appendChild(label);
  div.appendChild(bubble);
  chatbox.appendChild(div);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// ============================
// 4. OpenAI 호출 함수
// ============================

async function askBot(userText, context = {}) {
  const { area = null, category = null, fromButton = false } = context;

  const dataForAI = {
    storeList,
    hallOfFame
  };

  const contextInfoLines = [];
  if (area) contextInfoLines.push(`지역: ${area}`);
  if (category) contextInfoLines.push(`카테고리: ${category}`);
  if (fromButton) contextInfoLines.push("입력방식: 버튼 선택");

  const contextInfo = contextInfoLines.length
    ? `\n[추가 정보]\n${contextInfoLines.join("\n")}\n`
    : "";

  const systemPrompt = `
너는 "서울 맛집 & 놀거리 챗봇"이다.
아래 JSON 데이터 안에 포함된 매장들만 사용해서 추천해야 한다.

[데이터]
${JSON.stringify(dataForAI, null, 2)}

규칙:
1. 사용자의 문장에서 지역, 카테고리(식당/카페/놀거리/술집 등), 상황(데이트/친구/가족/혼밥 등)을 자연스럽게 추론해라.
2. 반드시 위 데이터(storeList, hallOfFame)의 매장만 추천해라. 데이터에 없는 가게 이름은 만들지 마라.
3. 사용자가 "데이트", "연인", "소개팅" 등 데이트 관련 표현을 쓰면:
   - 설명에 "데이트하기 좋음" 또는 "(데이트 좋음)"이 들어 있는 매장을 최우선으로 추천한다.
   - 그런 문구가 전혀 없는 지역인데 데이트 추천을 요청하면
     "해당 지역은 아직 데이트용 데이터가 부족해요."라는 문장을 반드시 포함해라.
4. 명예의 전당(hallOfFame)은 지역과 상관없이 정말 좋았던 곳이다.
   - 사용자가 "인생 맛집", "최애", "가장 추천", "명예의 전당" 같은 말을 쓰면 hallOfFame을 최우선으로 활용해라.
5. 버튼에서 지역/카테고리 정보가 주어진 경우:
   - 그 범위 안에서 1~3곳 정도를 골라 짧게 이유를 붙여 추천해라.
6. 사용자가 자유 입력(채팅)으로 물어보는 경우:
   - 문장 속에 있는 지역/카테고리를 우선 찾고, 없으면 먼저 어느 지역인지 정중하게 물어봐라.
7. 답변은 한국어로, 3~6줄 정도의 짧은 문단으로 말해라.
`;

  const userMessage = `사용자 질문: """${userText}"""${contextInfo}`;

  try {
    const res = await fetch("/.netlify/functions/ask", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    messages: [
      { role: "system", content: systemPrompt },
      { role: "user", content: userMessage }
    ]
  })
});


    if (!res.ok) {
      console.error("OpenAI API error:", res.status, await res.text());
      addMessage("bot", "AI 추천 중 오류가 발생했어요. API 키나 잔액을 확인해줘!");
      return;
    }

    const data = await res.json();

    let text = "";
    if (data.output_text) {
      text = data.output_text;
    } else if (Array.isArray(data.output) && data.output[0]?.content) {
      const c = data.output[0].content;
      if (Array.isArray(c) && c[0]?.text) {
        text = c[0].text;
      } else if (typeof c === "string") {
        text = c;
      }
    }

    if (!text) {
      text = "응답을 제대로 해석하지 못했어요. 질문을 조금만 다르게 다시 한 번 써줄래?";
    }

    addMessage("bot", text.trim());
  } catch (err) {
    console.error(err);
    addMessage("bot", "네트워크 오류가 발생했어요. 인터넷 연결이나 API 키 설정을 확인해줘!");
  }
}

// ============================
// 5. 지역/카테고리 버튼 이벤트 (명예의 전당 수정 버전)
// ============================

document.querySelectorAll(".region-btn").forEach((btn) => {
  btn.addEventListener("click", () => {
    const area = btn.dataset.area;

    // 👉 명예의 전당일 때: 지역처럼 보이지 않게 메시지 수정
    if (area === "명예의 전당") {
      addMessage("user", "명예의 전당 리스트를 보고 싶어요!");

      // 카테고리 버튼 제거
      categoryContainer.innerHTML = "";

      // AI 추천 호출
      askBot("명예의 전당에 있는 인생 맛집/놀거리 중에서 오늘 가기 좋은 곳 추천해줘.", {
        area,
        fromButton: true
      });
      return;
    }

    // 👉 일반 지역 처리
    addMessage("user", `${area} 지역 추천을 보고 싶어요.`);

    // 해당 지역 카테고리 불러오기
    const regionData = storeList[area];
    if (!regionData) {
      categoryContainer.innerHTML = "";
      addMessage("bot", "이 지역은 아직 데이터가 없어요. 나중에 업데이트할게!");
      return;
    }

    const categories = Object.keys(regionData);
    categoryContainer.innerHTML = "";

    const wrapper = document.createElement("div");
    wrapper.className = "category-buttons";

    categories.forEach((cat) => {
      const cbtn = document.createElement("button");
      cbtn.className = "category-btn";
      cbtn.textContent = cat;

      cbtn.addEventListener("click", () => {
        addMessage("user", `${area} · ${cat} 추천해줘.`);
        askBot(`${area}에서 ${cat} 추천해줘.`, {
          area,
          category: cat,
          fromButton: true
        });
      });

      wrapper.appendChild(cbtn);
    });

    categoryContainer.appendChild(wrapper);
  });
});

// ============================
// 6. 텍스트 입력(채팅) 이벤트
// ============================

sendBtn.addEventListener("click", () => {
  const text = input.value.trim();
  if (!text) return;
  addMessage("user", text);
  input.value = "";
  askBot(text, { fromButton: false });
});

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    sendBtn.click();
  }
});

// ============================
// 7. 처음 안내 메시지
// ============================
addMessage(
  "bot",
  "안녕! 나는 '서울 맛집 & 놀거리 챗봇'이야.\n아래에서 지역 버튼을 눌러도 되고, 직접\n예) \"외대 근처 데이트 식당 추천해줘\"\n같이 물어봐도 돼!"
);
